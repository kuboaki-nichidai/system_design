:linkcss:
:stylesdir: css
:stylesheet: mystyle.css
:twoinches: width='360'
:full-width: width='100%'
:three-quarters-width: width='75%'
:two-thirds-width: width='66%'
:half-width: width='50%'  
:half-size:
:one-thirds-width: width='33%'
:one-quarters-width: width='25%'
:thumbnail: width='60'
:imagesdir: images
:sourcesdir: codes
:icons: font
:hide-uri-scheme!:
:figure-caption: 図
:example-caption: リスト
:table-caption: 表
:appendix-caption: 付録
:xrefstyle: short
:section-refsig:
:chapter-refsig:

= 外部設計

NOTE: この演習は、グループで実施します。

== 【準備】要求分析の成果物をインポートする



要求分析のときに作ったモデルを外部設計のグループワークの入力情報として取り込みます。

.外部設計の準備
. 要求分析のときにグループで作成したモデル（astah*のファイル）を、 `models` ディレクトリにコピーします。
. `models` ディレクトリに保存したモデルの名前を「要求分析.asta」から「外部設計.asta」に変更します。
. 構造ツリーでプロジェクトを選択した状態で右クリックし、ポップアップメニューの「モデルの追加」から「モデル」を選びます。
. 新規に追加したモデルの名前を「02_外部設計」に変更します。
. 追加したモデル「02_外部設計」を選択した状態で右クリックし、ポップアップメニューの「図の追加」から「クラス図」を選びます。


== 【演習】外部設計の初期のクラス図を作る

追加したクラス図を使って、外部設計を進めます。

NOTE: astah* のクラス図の使い方は、「Astahのチュートリアル」でやっています。

自分たちの作るシステムが「外部からみて」どのような構造や振る舞いを持つのかを議論します。
最初は、構成する要素の候補を出します。
ここで出す要素は、システムの実装に必要な内部のものではなく、外部から見た要素です。

まず、サブシステムの候補を探します。

[TIP]
--
最初に挙げるものは、サブシステムは候補ですので、本当にサブシステムになるのかを吟味しなくてもかまいません。
外部設計の振舞いを設計した後に、本当に必要かどうかを判定します。
--

.サブシステムの候補を探す
. 開発単位（チーム、モジュール）が異なる部分があれば、あればそこで分割します。
. 通信する部分がある（送る側、受ける側がある）か、あればそこで分割します。
. システムの内部で登場する人（アクターではない内部の人）とのやり取りがある部分があれば、そこで分割します。
. 分割したそれぞれをサブシステムの候補とします。
. 要求分析で登場したアクターを、外部設計のクラス図の構成要素として追加します。
** やりとりを整理するときに、アクターがあると表現しやすいからです。

NOTE: サブシステム用のシンボルもありますが、この演習ではサブシステムもクラスを使って表すことにしましょう。

.サブシステム候補をクラス図に追加する
. 候補になったものをクラスとしてクラス図に追加します。
. 追加したクラスにサブシステムとしての名前をつけます。
. 追加したクラスのステレオタイプに `subsystem` を追加します。
. 関連はまだ引きません。

ここで、初期の外部設計のクラス図の画像を `sys_design_class_1.png` として `images` ディレクトリに保存します。

.外部設計の初期のクラス図（サブシステムの候補）
image::sys_design_class_1.png[{full-width}]

NOTE: ここでコミットしておきます。

== 【演習】外部設計のシーケンス図を作る

サブシステムも候補とアクターを使って、シーケンス図を作成します。

.アクターやサブシステムの間のやり取りを整理する
. 構造ツリーの「01_外部設計」を選択した状態で、図の追加＞シーケンス図で、シーケンス図を追加します。
. 追加したシーケンス図の名前を「外部設計のシーケンス図」に変更します。
** もし、要求分析のユースケースが複数あるなら、ユースケースごとにシーケンス図を描きます。
** このときは、「外部設計のユースケース「XXXX」のシーケンス図」のような名前にしておきます。
. 追加したシーケンス図に、構造ツリーからクラスの候補とアクターをドラッグ＆ドロップして追加します。
** クラスやアクターをシーケンス図に追加すると、ライフラインが現れますので、適当な間隔に並べます。
. 要求分析のユースケース記述を参照しながら、並べた候補の間のやり取りをメッセージとして追加します。
** アクターとのやりとりはユースケース記述に明記されているでしょうから、それを使います。
** サブシステム候補間のやりとりはユースケース記述に明示されていないでしょう。これについては、外部設計としてやり取りを検討して追加します。
** メッセージは基本的に「非同期」になります。
** メッセージの先端が黒く塗りつぶされたものは同期メッセージを表し、塗りつぶされていないものは非同期メッセージを表します。
** 非同期のメッセージを使う場合、相手からメッセージを受け取ったら、受け取った側もメッセージを送る形になります。
** シーケンス図のメッセージのプロパティには同期と非同期の切り替えがあります。

ここで、外部設計のシーケンス図（あるいはそのユースケース記述ごとのシーケンス図）を `sys_design_seq_X.png` として `images` ディレクトリに保存します（ここでファイル名のXは、 1, 2, 3 ...のような数字です）。

.外部設計のユースケース「XXXX」のシーケンス図
image::sys_design_seq_1.png[{full-width}]


.外部設計のユースケース「YYYY」のシーケンス図
image::sys_design_seq_2.png[{full-width}]


NOTE: 必要な数だけ上記を複製して、ここにシーケンス図を挿入してください。


NOTE: ここでコミットしておきます。


== 【演習】外部設計のクラス図をブラッシュアップする


サブシステム候補間のやりとりが整理できたので、クラス図を見直します。

.シーケンス図をみながら、クラス間に関連を引きます。
. シーケンス図でメッセージでつながっているサブシステムに着目し、クラス図でこれらの間に関連を引きます。
** もし、双方向ではなく、一方からだけメッセージが送られているようなら、矢印つきの関連を使うとよいでしょう。

.外部設計のサブシステム候補を整理する
. いずれのシーケンス図でもやりとりに参加していない候補は、おそらくサブシステムではないでしょう。
** 該当する候補に「サブシステムではなかった」というノートを付けて、クラス図の端へ追いやります（消さないことに注意）。
** 残ったサブシステムが外設計における、システムの構成要素になります。

シーケンス図に登場したメッセージを参考に、サブシステムの操作を追加しましょう。

.サブシステムに操作を追加する
. メッセージを受け取っている側のクラスに、受けっとているメッセージを操作として追加します。
** サブシステムの操作として追加したときに違和感があるときは、メッセージが受け取り側にやってもらうことを書いているか確認します。
** （例）緑の窓口の係はきっぷを「売る」のか「買う」のか
. すべてのシーケンス図について、メッセージを操作にする作業を繰り返します。


ここで、サブシステム検討後の外部設計のクラス図の画像を `sys_design_class_2.png` として `images` ディレクトリに保存します。

.サブシステム検討後の外部設計のクラス図
image::sys_design_class_2.png[{full-width}]

NOTE: ここでコミットしておきます。

もし、ユースケースが不足していた、ユースケース記述が不十分だったなどの問題が発生した場合には、要求分析に戻って図や文書を更新します。その後、外部設計の図や文書を対応させます。
